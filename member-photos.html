<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BLA Members Photo Gallery - TVK</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #DC143C 0%, #8B0000 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        h1 {
            color: #DC143C;
            margin-bottom: 10px;
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 15px;
        }

        .stat {
            text-align: center;
        }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: #DC143C;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
        }

        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .member-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .member-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.2);
        }

        .photo-container {
            width: 100%;
            height: 300px;
            overflow: hidden;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .member-photo {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .no-photo {
            color: #999;
            font-size: 48px;
        }

        .member-info {
            padding: 15px;
        }

        .member-name {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .member-details {
            font-size: 14px;
            color: #666;
            margin: 3px 0;
        }

        .member-id {
            font-size: 12px;
            color: #999;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            margin-top: 8px;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: white;
            font-size: 18px;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .refresh-btn {
            background: #DC143C;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
        }

        .refresh-btn:hover {
            background: #B01030;
        }

        .filters {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-input {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .filter-input:focus {
            outline: none;
            border-color: #DC143C;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ЁЯЦ╝я╕П BLA роЙро▒рпБрокрпНрокро┐ройро░рпНроХро│рпН рокрпБроХрпИрокрпНрокроЯ роХро╛роЯрпНроЪро┐</h1>
            <p>TVK роХроЯрпНроЪро┐ роЙро▒рпБрокрпНрокро┐ройро░рпНроХро│рпН рокрпБроХрпИрокрпНрокроЯроЩрпНроХро│рпН</p>
            <div class="stats">
                <div class="stat">
                    <div class="stat-number" id="totalMembers">0</div>
                    <div class="stat-label">роорпКродрпНрод роЙро▒рпБрокрпНрокро┐ройро░рпНроХро│рпН</div>
                </div>
                <div class="stat">
                    <div class="stat-number" id="withPhotos">0</div>
                    <div class="stat-label">рокрпБроХрпИрокрпНрокроЯродрпНродрпБроЯройрпН</div>
                </div>
            </div>
            <button class="refresh-btn" onclick="loadMembers()">ЁЯФД Refresh</button>
        </div>

        <div class="filters">
            <input type="text" class="filter-input" id="searchInput" placeholder="рокрпЖропро░рпН родрпЗроЯрпБроЩрпНроХро│рпН..." onkeyup="filterMembers()">
            <select class="filter-input" id="districtFilter" onchange="filterMembers()">
                <option value="">роЕройрпИродрпНродрпБ рооро╛ро╡роЯрпНроЯроЩрпНроХро│рпН</option>
            </select>
            <select class="filter-input" id="genderFilter" onchange="filterMembers()">
                <option value="">роЕройрпИродрпНродрпБ рокро╛ро▓ро┐ройроорпН</option>
                <option value="male">роЖрогрпН</option>
                <option value="female">рокрпЖрогрпН</option>
                <option value="other">рооро▒рпНро▒ро╡рпИ</option>
            </select>
            <select class="filter-input" id="categoryFilter" onchange="filterMembers()">
                <option value="">роЕройрпИродрпНродрпБ ро╡роХрпИроХро│рпН</option>
                <option value="рооро╛ро▒рпНро▒рпБродрпНродро┐ро▒ройро╛ро│ро┐">рооро╛ро▒рпНро▒рпБродрпНродро┐ро▒ройро╛ро│ро┐</option>
                <option value="роорпБродро┐ропрпЛро░рпН">роорпБродро┐ропрпЛро░рпН</option>
                <option value="роорпВройрпНро▒ро╛роорпН рокро╛ро▓ро┐ройроорпН">роорпВройрпНро▒ро╛роорпН рокро╛ро▓ро┐ройроорпН</option>
            </select>
            <select class="filter-input" id="statusFilter" onchange="filterMembers()">
                <option value="">роЕройрпИродрпНродрпБ роиро┐ро▓рпИроХро│рпН</option>
                <option value="active">Active</option>
                <option value="pending">Pending</option>
            </select>
        </div>

        <div id="loading" class="loading">Loading members...</div>
        <div id="error" class="error" style="display: none;"></div>
        <div id="gallery" class="gallery"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.min.js"></script>
    <script>
        // Supabase configuration
        const SUPABASE_URL = 'https://cbcuhojwffwppocnoxel.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNiY3Vob2p3ZmZ3cHBvY25veGVsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg5ODY3NDYsImV4cCI6MjA3NDU2Mjc0Nn0.yYdiAY297k7dA2uUYnIlePy8xE0k8veUu_LoVae_QvI';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        let allMembers = [];

        async function loadMembers() {
            const loadingDiv = document.getElementById('loading');
            const errorDiv = document.getElementById('error');
            const galleryDiv = document.getElementById('gallery');
            
            loadingDiv.style.display = 'block';
            errorDiv.style.display = 'none';
            galleryDiv.innerHTML = '';
            
            try {
                // Fetch all members
                const { data: membersData, error: membersError } = await supabase
                    .from('bla_members')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (membersError) throw membersError;
                
                // Fetch all employees
                const { data: employeesData, error: employeesError } = await supabase
                    .from('employees')
                    .select('id, full_name, username');
                
                if (employeesError) throw employeesError;
                
                // Create employee lookup map
                const employeeMap = {};
                (employeesData || []).forEach(emp => {
                    employeeMap[emp.id] = emp;
                });
                
                // Attach employee data to members
                allMembers = (membersData || []).map(member => ({
                    ...member,
                    registered_by: member.registered_by_employee_id ? employeeMap[member.registered_by_employee_id] : null
                }));
                
                // Update stats
                document.getElementById('totalMembers').textContent = allMembers.length;
                document.getElementById('withPhotos').textContent = allMembers.filter(m => m.photo_url).length;
                
                // Populate district filter
                const districts = [...new Set(allMembers.map(m => m.district).filter(Boolean))];
                const districtFilter = document.getElementById('districtFilter');
                districtFilter.innerHTML = '<option value="">роЕройрпИродрпНродрпБ рооро╛ро╡роЯрпНроЯроЩрпНроХро│рпН</option>';
                districts.forEach(district => {
                    const option = document.createElement('option');
                    option.value = district;
                    option.textContent = district;
                    districtFilter.appendChild(option);
                });
                
                displayMembers(allMembers);
                
            } catch (error) {
                console.error('Error loading members:', error);
                errorDiv.textContent = 'Error loading members: ' + error.message;
                errorDiv.style.display = 'block';
            } finally {
                loadingDiv.style.display = 'none';
            }
        }

        function displayMembers(members) {
            const galleryDiv = document.getElementById('gallery');
            galleryDiv.innerHTML = '';
            
            if (members.length === 0) {
                galleryDiv.innerHTML = '<div class="error">No members found</div>';
                return;
            }
            
            members.forEach(member => {
                const card = document.createElement('div');
                card.className = 'member-card';
                
                const photoContainer = document.createElement('div');
                photoContainer.className = 'photo-container';
                
                if (member.photo_url) {
                    const img = document.createElement('img');
                    img.className = 'member-photo';
                    img.src = member.photo_url;
                    img.alt = member.full_name;
                    img.onerror = function() {
                        this.parentElement.innerHTML = '<div class="no-photo">ЁЯУ╖</div>';
                    };
                    photoContainer.appendChild(img);
                } else {
                    photoContainer.innerHTML = '<div class="no-photo">ЁЯУ╖</div>';
                }
                
                const infoDiv = document.createElement('div');
                infoDiv.className = 'member-info';
                infoDiv.innerHTML = `
                    <div class="member-name">${member.full_name || 'N/A'}</div>
                    <div class="member-details">родроирпНродрпИ: ${member.father_name || 'N/A'}</div>
                    <div class="member-details">ЁЯУ▒ ${member.mobile || 'N/A'}</div>
                    <div class="member-details">ЁЯУН ${member.district || 'N/A'}</div>
                    ${member.voter_id ? `<div class="member-details">ЁЯЧ│я╕П ${member.voter_id}</div>` : ''}
                    ${member.registered_by ? `<div class="member-details" style="color: #666; font-size: 12px; margin-top: 8px;">тЬНя╕П рокродро┐ро╡рпБ роЪрпЖропрпНродро╡ро░рпН: ${member.registered_by.full_name || member.registered_by.username}</div>` : ''}
                    <span class="status-badge status-${member.status || 'pending'}">
                        ${member.status || 'pending'}
                    </span>
                    <div class="member-id">ID: ${member.membership_number || member.id}</div>
                `;
                
                card.appendChild(photoContainer);
                card.appendChild(infoDiv);
                galleryDiv.appendChild(card);
            });
        }

        function filterMembers() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const districtFilter = document.getElementById('districtFilter').value;
            const genderFilter = document.getElementById('genderFilter').value;
            const categoryFilter = document.getElementById('categoryFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            
            const filtered = allMembers.filter(member => {
                const matchesSearch = !searchTerm || 
                    (member.full_name && member.full_name.toLowerCase().includes(searchTerm)) ||
                    (member.father_name && member.father_name.toLowerCase().includes(searchTerm)) ||
                    (member.mobile && member.mobile.includes(searchTerm));
                
                const matchesDistrict = !districtFilter || member.district === districtFilter;
                const matchesGender = !genderFilter || member.gender === genderFilter;
                const matchesCategory = !categoryFilter || 
                    (member.member_category && member.member_category.includes(categoryFilter));
                const matchesStatus = !statusFilter || member.status === statusFilter;
                
                return matchesSearch && matchesDistrict && matchesGender && matchesCategory && matchesStatus;
            });
            
            displayMembers(filtered);
        }

        // Load members on page load
        window.addEventListener('load', loadMembers);
    </script>
</body>
</html>